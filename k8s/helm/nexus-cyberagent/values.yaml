# Default values for nexus-cyberagent
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

## Global settings
global:
  imageRegistry: ""
  imagePullSecrets: []

## Image configuration
image:
  api:
    repository: adverant/nexus-cyberagent-api
    pullPolicy: IfNotPresent
    tag: "1.0.0"
  worker:
    repository: adverant/nexus-cyberagent-worker
    pullPolicy: IfNotPresent
    tag: "1.0.0"

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

## Replica configuration
replicaCount:
  api: 3
  worker: 5

## Service account
serviceAccount:
  create: true
  annotations: {}
  name: ""

## Pod annotations
podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "3000"
  prometheus.io/path: "/metrics"

## Pod security context
podSecurityContext:
  fsGroup: 1000
  runAsNonRoot: true
  runAsUser: 1000

## Container security context
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: false
  runAsNonRoot: true
  runAsUser: 1000

## Service configuration
service:
  type: ClusterIP
  port: 3000
  targetPort: 3000
  annotations: {}

## Ingress configuration
ingress:
  enabled: true
  className: "nginx"
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    nginx.ingress.kubernetes.io/proxy-body-size: "100m"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "600"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "600"
  hosts:
    - host: nexus.example.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: nexus-tls
      hosts:
        - nexus.example.com

## Resource limits and requests
resources:
  api:
    limits:
      cpu: 2000m
      memory: 4Gi
    requests:
      cpu: 1000m
      memory: 2Gi
  worker:
    limits:
      cpu: 4000m
      memory: 8Gi
    requests:
      cpu: 2000m
      memory: 4Gi

## Autoscaling configuration
autoscaling:
  api:
    enabled: true
    minReplicas: 3
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80
  worker:
    enabled: true
    minReplicas: 5
    maxReplicas: 20
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80

## Node selection
nodeSelector: {}

## Tolerations
tolerations: []

## Affinity rules
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app
                operator: In
                values:
                  - nexus-api
                  - nexus-worker
          topologyKey: kubernetes.io/hostname

## Environment variables
env:
  NODE_ENV: production
  LOG_LEVEL: info
  PORT: "3000"
  # Nexus services
  GRAPHRAG_API_URL: http://nexus-graphrag:9001
  MAGEAGENT_API_URL: http://nexus-mageagent:9002
  ORCHESTRATIONAGENT_API_URL: http://unified-nexus-orchestration:9003
  LEARNINGAGENT_API_URL: http://unified-nexus-learning:9004
  SPECTRUMAGENT_API_URL: http://unified-nexus-spectrum:9005
  # Monitoring
  PROMETHEUS_ENABLED: "true"
  JAEGER_ENABLED: "true"
  JAEGER_ENDPOINT: http://jaeger-collector:14268/api/traces

## Secrets (create separately)
secrets:
  existingSecret: "nexus-secrets"
  # If existingSecret is not provided, these values will be used
  # (NOT recommended for production - use existingSecret)
  databaseUrl: ""
  redisUrl: ""
  jwtSecret: ""
  encryptionMasterKey: ""
  sessionSecret: ""

## PostgreSQL configuration (using Bitnami chart)
postgresql:
  enabled: true
  auth:
    username: nexus_user
    password: ""  # Set in secrets
    database: nexus_cyberagent
  primary:
    persistence:
      enabled: true
      size: 500Gi
      storageClass: "fast-ssd"
    resources:
      limits:
        cpu: 4000m
        memory: 8Gi
      requests:
        cpu: 2000m
        memory: 4Gi
  readReplicas:
    replicaCount: 2
    persistence:
      enabled: true
      size: 500Gi
    resources:
      limits:
        cpu: 2000m
        memory: 4Gi
      requests:
        cpu: 1000m
        memory: 2Gi

## Redis configuration (using Bitnami chart)
redis:
  enabled: true
  auth:
    enabled: true
    password: ""  # Set in secrets
  master:
    persistence:
      enabled: true
      size: 50Gi
      storageClass: "fast-ssd"
    resources:
      limits:
        cpu: 1000m
        memory: 2Gi
      requests:
        cpu: 500m
        memory: 1Gi
  replica:
    replicaCount: 2
    persistence:
      enabled: true
      size: 50Gi
    resources:
      limits:
        cpu: 1000m
        memory: 2Gi
      requests:
        cpu: 500m
        memory: 1Gi

## Persistent volumes
persistence:
  malwareSamples:
    enabled: true
    storageClass: "fast-ssd"
    size: 1Ti
    accessMode: ReadWriteMany

## Health checks
livenessProbe:
  httpGet:
    path: /health
    port: 3000
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /health
    port: 3000
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

## Monitoring
monitoring:
  enabled: true
  serviceMonitor:
    enabled: true
    interval: 30s
    scrapeTimeout: 10s
  prometheusRule:
    enabled: true

## Network policies
networkPolicy:
  enabled: true
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              name: nexus-cyberagent
      ports:
        - protocol: TCP
          port: 3000
  egress:
    - to:
        - namespaceSelector: {}
      ports:
        - protocol: TCP
          port: 5432  # PostgreSQL
        - protocol: TCP
          port: 6379  # Redis
    - to:  # Nexus services
        - namespaceSelector:
            matchLabels:
              name: unified-nexus
      ports:
        - protocol: TCP
          port: 9001
        - protocol: TCP
          port: 9002
        - protocol: TCP
          port: 9003
        - protocol: TCP
          port: 9004
        - protocol: TCP
          port: 9005

## Pod disruption budget
podDisruptionBudget:
  enabled: true
  api:
    minAvailable: 2
  worker:
    minAvailable: 3

## Priority class
priorityClassName: ""

## Backup configuration
backup:
  enabled: true
  schedule: "0 2 * * *"  # Daily at 2 AM
  retention: 30  # days
  storageClass: "standard"
  size: 100Gi
